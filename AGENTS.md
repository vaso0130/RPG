# 這是一個結合Gemini API的RPG遊戲

## 待辦事項 (To-Do List)

- **技能進化系統**：實作普通、魔法、科技技能的進化路徑與效果。
- **道具特殊效果**：為神器與魔王遺物添加獨特的被動/主動效果，並與信仰/腐化系統連動。
- **戰鬥系統**：設計並實作更詳細的戰鬥規則，包括敵人 AI、回合制或即時制戰鬥流程。
- **世界事件**：擴充更多動態的世界事件、隨機遭遇和任務鏈。
- **使用者體驗優化**：持續測試與優化遊戲流程、錯誤處理與文字介面。
- **儲存格式兼容性**：測試並確保未來的遊戲擴充不會破壞現有的存檔檔案。
- **自動化測試**：為核心模組編寫單元測試，確保程式碼穩定性。

---

## 已完成但尚未測是的功能 (Completed Features)

- **核心遊戲迴圈**：建立 `game.py`，整合角色創建、主遊戲迴圈、行動處理與骰子機制。
- **角色系統 (`player.py`)**：完成角色創建、屬性分配、成長點數、信仰/腐化值、物品管理（新增、裝備、卸下、使用）、以及動態屬性計算。
- **世界觀建構 (`world.py`)**：建立包含地點、種族、以及大量預設物品（消耗品、裝備、神器、魔王遺物）的字典。
- **動態物品創造**：AI (GM) 被授權在遊戲過程中創造全新的裝備或神器，並透過 JSON 格式回傳。遊戲能自動解析並將新物品加入 `world.items` 定義中。
- **AI 敘事核心 (`narrator.py`)**：
  - 串接 Gemini API，並具備對話歷史記憶功能。
  - AI 能根據玩家行動進行動態場景描述、行動評估與結果敘述。
  - AI 的回應格式升級，可同時回傳敘述、GP、信仰/腐化變化及獲得的物品（包含其 JSON 定義）。
- **存檔與讀取機制**：
  - 實現 `save_game` 與 `load_game` 功能。
  - 存檔內容包含完整的 `player` 物件、`world` 物件（含動態新增的物品）以及 AI 的對話歷史。
  - 讀取時能完整還原遊戲狀態與 AI 記憶，確保遊戲體驗的連續性。

---

## 遊戲設計

### 1. 核心機制

- 遊戲以 20 面骰為主體機制，每次擲骰可依不同情境決定成功門檻與加減值。
- 玩家每次進行重要行動時（說服、攻擊、閃避、駭入、開鎖等）都需進行骰子檢定。
- 遊戲為純文字角色扮演，由 AI 擔任遊戲主持人（GM），敘述場景、引導故事。
- 玩家可請求由 AI 生成真實風格的場景圖片，作為視覺輔助。
- 本作為沙盒式開放世界 RPG，玩家可自由探索、發展角色、選擇命運。

### 2. 世界觀與背景設定

#### 架空的現代地球

世界為科技、魔法與神話融合的現代平行地球。

現實世界的城市如紐約、東京、台北等都存在，但可能混有精靈區、矮人地下鐵道等奇幻要素。

魔法、科技、信仰、神祇、超能力共存，世界局勢混亂，各地有不同陣營與勢力。

#### 種族選項

- 人類（Human）
- 城市精靈（Urban Elf）
- 木精靈（Woodland Elf）
- 沙漠精靈（Desert Elf）
- 黑暗精靈（Dark Elf）
- 矮人（Dwarf）
- 森林半獸人（Lycan）
- 海洋半獸人（Gillfolk）
- 龍裔（Dragonborn）

每個種族擁有不同種族特色與專屬技能，未來會陸續擴充細節與族群背景。

#### 神祇與魔王

- 舊神：上古存在的神明，曾經主宰世界秩序，但因信仰式微已失去大部分力量。
- 新神：人類文明崛起後出現的神祇，與現代價值結合，擁有教會體系與奇蹟力量。
- 魔王：邪神，原為被封印的遠古存在，因人類信仰崩壞，逐漸復甦並以耳語方式洗腦眾生。

📌 舊神雖無教派，但其神器仍具力量。若玩家願意創建宗教，推廣信仰，可逐步引出舊神奇蹟。

📌 魔王無法直接信仰。玩家須經歷腐化過程才可能墮落為魔王軍或建立自己的黑暗秩序。

### 3. 技能與能力系統

#### 基礎屬性

| 屬性 | 英文 | 代表能力 |
| :--- | :--- | :--- |
| 力量 | STR | 影響物理攻擊、負重、近戰傷害。 |
| 敏捷 | DEX | 影響閃避、命中、潛行、先攻順序。 |
| 體質 | CON | 影響生命值、抵抗力、耐力。 |
| 智力 | INT | 影響魔法效果、知識、科技裝置使用。 |
| 感知 | WIS | 影響觀察、直覺、意志、對抗精神魔法。 |
| 魅力 | CHA | 影響說服、交易、領導、奇蹟效果。 |

#### 技能來源分類

- 普通技能（General Skills）：現代社會學習所得，如駭客術、醫療、談判、語言、潛行等。
- 魔法技能（Arcane Spells）：來自古代書籍、禁術、師傅、傳承等，如火球術、心靈操控、混沌閃電。
- 科技技能（Tech Augments）：由強化模組或裝備獲得，如能量盾、神經插槽、無人機操控。
- 奇蹟技能（Divine Miracles）：新神所賜予的力量，透過劇情、信仰、任務或契約觸發，威力極大。
- 魔王系技能（Corruption Powers）：來自禁忌儀式或黑暗契約的能力，有副作用與精神污染風險。

附註除了奇蹟與魔王系技能外，所有技能都能進一步進化，例如「火球術 → 烈焰爆破 → 流星焚界」

#### 裝備與道具分類

- 一般裝備：常見槍械、防具、電子設備。
- 特製裝備：融合科技與魔法的武器或裝備。
- 神器（Artifacts）：舊神所遺留的造物，不需信仰即可啟動，重建信仰可解鎖更高潛力。
- 魔王遺物（Dark Relics）：具腐化性質的強大裝備或道具。
- 消耗道具：補品、陷阱、煙霧彈、詛咒解除符等。

### 4. 信仰與墮落機制

#### 信仰規則

- 玩家無法開局選擇信仰，一切信念將依據故事演進與抉擇形成。
- 玩家可能在冒險中逐漸接觸某位新神，進而獲得奇蹟；或建立自己的舊神教派。
- 信仰的養成會影響角色發展、NPC態度、陣營互動。

#### 腐化與魔王耳語

- 玩家接觸禁術、黑暗遺物、遭受夢境入侵等事件後，會逐步產生腐化值。
- 腐化可能導致技能獲得、情緒失控、奇怪幻覺，也可能解鎖強大黑暗技能。
- 玩家可選擇對抗耳語、試圖淨化，或順從墮落、挑戰魔王、奪取黑暗王座。

### 5. 劇情與遊玩方式

#### 遊戲進行方式

- AI 扮演 GM，敘述場景、提供選項與挑戰。
- 玩家可自由選擇行動（包含非預設選項），合理即納入劇情。
- 必要時擲骰檢定，AI 決定成功與否。
- 玩家可探索都市、遺跡、教會、黑市、軍事基地、神殿等地。
- 可進行組隊、背叛、建立勢力、經營宗教、與神交易或策動世界規模事件。

### 6. 勝敗條件

#### 勝利條件（任一達成即勝利）

- 擊敗魔王，阻止世界終結，成為救世主。
- 成功奪權，成為新的魔王或黑暗秩序建立者。

#### 失敗條件（任一發生即結束）

- 世界毀滅：魔王完成儀式，世界陷入黑暗。
- 信仰崩壞：舊神與新神全數潰敗，人類失去希望。
- 角色死亡／完全墮落：失去自我，淪為工具。

### 7. 創角與開始方式

玩家可選擇以下兩種方式開始遊戲：

#### 角色創建

- 選擇種族（9選1）
- 設定初始背景（職業、生平經歷）
- 分配初始屬性（STR, DEX, INT, WIS, CHA, CON，共10點）

#### 即興冒險

- 由 AI 隨機設計一個角色背景與場景，玩家直接進入冒險

### 8. 角色成長機制

#### 成長點數（Growth Points, GP）

- **獲取**：玩家透過完成任務、達成重要劇情、成功進行高難度檢定、擊敗強大敵人等方式獲得成長點數。GP 的給予由 GM（AI）根據事件的重要性決定。
- **用途**：GP 是角色成長的核心資源，可用於：
  - 提升基礎屬性。
  - 學習新技能。
  - 進化現有技能。

#### 屬性提升

- 玩家可以消耗 GP 來永久提升角色的六大基礎屬性。
- 每提升 1 點屬性，需要消耗 `目前屬性值 / 2` (無條件進位) 的 GP。例如，將力量從 12 提升到 13 需要 6 GP。

#### 技能學習與進化

- **學習新技能**：玩家可以在冒險中向導師學習、研究書籍、或透過劇情解鎖來獲得學習新技能的機會。學習時需要消耗一定數量的 GP。
- **技能進化**：大部分普通、魔法、科技技能都擁有進化路徑。
  - **進化條件**：通常需要將技能熟練運用（由 GM 判斷）並消耗大量 GP。
  - **進化範例**：
    - 駭客術 (等級1) → 資料探勘 (等級2) → 神經入侵 (等級3)
    - 火球術 (等級1) → 烈焰爆破 (等級2) → 流星焚界 (等級3)
- 奇蹟與魔王系技能的成長方式較為特殊，通常與信仰和劇情抉擇掛鉤，而非單純消耗 GP。
